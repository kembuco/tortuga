<!doctype html>
<html>
    <head>
        <title>Tortuga Pen</title>
        <style type="text/css">body{background-color:#A9E27F;height:100%;font-family:"Lucida Sans Unicode", "Lucida Grande", sans-serif}#content{width:300px;background-color:rgba(223,223,223,0.6);-webkit-border-radius:5px;-moz-border-radius:5px;border-radius:5px;position:relative;margin:auto;padding:10px 10px 5px}#tortuga{position:absolute;z-index:10}#workspace{display:block;background-color:#FFF}#console{margin-top:10px;width:290px;opacity:.8;padding:5px}#console,#in{background-color:#000;color:#FFF;text-transform:uppercase;font-family:Lucida Console, Monaco, monospace;font-size:12px}#console .error{color:red}#in{width:273px;border:0;outline-width:0}#out{height:205px;overflow:auto;list-style:none;margin:0;padding:0}#out li{padding-top:2px}#links a,#links span{float:right;margin-left:5px;font-size:12px;color:#000;text-decoration:none}#links div{clear:both}#logo{position:absolute;top:337px;left:50px;white-space:nowrap;z-index:-1;font-size:164px}</style>
        <script src="http://ajax.microsoft.com/ajax/jquery/jquery-1.4.2.min.js" type="text/javascript"></script>
        <script type="text/javascript">(function(){var j=parseInt,k=Math,l=k.PI,m=l*2,n=[],o={help:["<em>command</em>","Lists all of the available commands, or, given a command name, shows the help for the command. e.g. 'HELP ALIAS'"],alias:["[<em>command</em> <em>alias</em>]","Aliases the given command with the new alias. e.g. 'ALIAS [FORWARD F]'"],forward:["<em>pixels</em>","Moves the turtle forward <em>n</em> pixels. e.g. 'FORWARD 10'"],back:["<em>pixels</em>","Moves the turtle back <em>n</em> pixels. e.g. 'BACK 10'"],left:["<em>degrees</em>", "Turns the turtle <em>n</em> degrees to the left. e.g. 'LEFT 45'"],right:["<em>degrees</em>","Turns the turtle <em>n</em> degrees to the right. e.g. 'RIGHT 45'"],penup:["","Pulls the pen up off the canvas so that if the turtle moves it <em>will not<em> draw a line"],pendown:["","Puts the pen down on the canvas so that if the turtle moves it <em>will</em> draw a line"],home:["","Moves the turtle back to its starting position"],clearscreen:["","Clears the canvas, moves the turtle to its starting position, and resets the command history"], clean:["","Clears the canvas and resets the command history"],linewidth:["","<em>pixels</em>","Sets the width of the pen in pixels. e.g. 'LINEWIDTH 5'"],moveto:["[<em>x</em> <em>y</em>]","Moves the turtle to the supplied coordinates. Takes pendown/penup state into account. e.g. 'MOVETO [10 10]'"],saveas:["<em>name</em>","Saves the current command history as a program in localStorage. e.g. 'SAVE BOX'"],load:["<em>name</em>","If a program with the given name exists in localStorage, it is loaded and run. e.g. 'LOAD BOX'"]}, p={IllegalArgument:"Something is not right with the supplied arguments",UnknownCommand:"Command not recognized",ProcNotFound:"Couldn't find the specified program"};Tortuga=function(a){var b=this.alias;$.extend(this,{pendown:true,heading:270,history:[],x:0,y:0},a||{});a=this.el=$(this.el);var c=this.cursor=$(this.cursor),d=this.x=this.halfWidth=a.width()/2,e=this.y=this.halfHeight=a.height()/2;this.context=a[0].getContext("2d");this.cursorContext=c[0].getContext("2d");this.cursorOffset={x:c.width()/ 2,y:c.height()/2};this.moveCursor(d,e);this.drawCursor();b.call(this,"forward","fd");b.call(this,"back","bk");b.call(this,"right","rt");b.call(this,"left","lt");b.call(this,"penup","pu");b.call(this,"pendown","pd");b.call(this,"clearscreen","clear");b.call(this,"moveto","mv")};Tortuga.prototype={oob:function(a,b){return a<0||a>this.el.width()||b<0||b>this.el.height()},moveCursor:function(a,b){var c=this.cursor,d=this.cursorOffset,e=a-d.x+10;d=b-d.y+10;c[this.oob(a,b)?"hide":"show"]();c.css({top:d, left:e})},drawAnchoredCircle:function(a,b,c,d,e,i,h,g,f){g=g*l/180;f=(15+(f||0))*b;c=c+f*k.cos(g);d=d+f*k.sin(g);a.fillStyle=i;a.beginPath();a.arc(c,d,e*b,0,m,true);a.fill();h&&a.stroke()},drawCursor:function(a,b,c,d,e,i){var h=this.cursor,g=this.drawAnchoredCircle,f=c||this.cursorOffset;c=f.x;f=f.y;b=b||{};a=a||this.cursorContext;d=d||this.heading;e=e||1;a.clearRect(0,0,b.width||h.width(),b.height||h.height());a.globalAlpha=i||0.6;a.strokeStyle="#996633";a.lineWidth=e;b=a.createRadialGradient(c, f,1*e,c,f,10*e);b.addColorStop(0,"#66CC33");b.addColorStop(1,"#339900");a.fillStyle=b;a.beginPath();a.arc(c,f,10*e,0,m,true);a.fill();a.stroke();g.call(this,a,e,c,f,5,"#66CC33",true,d);g.call(this,a,e,c,f,1,"#000000",false,d-6,1);g.call(this,a,e,c,f,1,"#000000",false,d+6,1);g.call(this,a,e,c,f,2,"#66CC33",true,d-45,-3);g.call(this,a,e,c,f,2,"#66CC33",true,d+45,-3);g.call(this,a,e,c,f,2,"#66CC33",true,d-135,-3);g.call(this,a,e,c,f,2,"#66CC33",true,d+135,-3);this.pendown||this.disableCursor()},disableCursor:function(){var a= this.cursor,b=this.cursorContext;a=b.getImageData(0,0,a.width(),a.height());var c=a.height,d=a.width,e,i,h,g,f;for(f=0;f<d;f++)for(g=0;g<c;g++){h=f*4*d+g*4;e=a.data[h+3];i=(a.data[h]+a.data[h+1]+a.data[h+2])/3;a.data[h]=i;a.data[h+1]=i;a.data[h+2]=i;a.data[h+3]=e}b.putImageData(a,0,0,0,0,d,c)},acceptCommand:function(a,b){if(a){var c=this.parseDirective(a);b||this.history.push(a);return this.runCommand(c.command,c.args)}},runCommand:function(a,b){if(a=this.commands[a])return a.apply(this,b);else throw"UnknownCommand"; },parseDirective:function(a){a=a.replace(/[\[|\]]/g," ").split(" ");return{command:a.reverse().pop().replace("?","p"),args:$.grep(a.reverse(),function(b){return b!==""})}},rotate:function(a){if(!a&&a!==0)throw"IllegalArgument";a=this.heading+a;this.heading=a>360?a%360:a<0?360+a%360:a;this.drawCursor()},moveTo:function(a,b){var c=this.context;if(this.pendown){c.lineJoin="miter";c.beginPath();c.moveTo(this.x,this.y);c.lineTo(a,b);c.stroke()}this.x=a;this.y=b;this.moveCursor(a,b)},move:function(a){if(!a&& a!==0)throw"IllegalArgument";var b=Math,c=this.heading*b.PI,d=this.x+a*b.cos(c/180);a=this.y+a*b.sin(c/180);this.moveTo(d,a)},alias:function(a,b){if(!this.commands[a])throw"IllegalArgument";this.commands[b]=this.commands[a];n.push(b)},commands:{saveas:function(a){if(!a)throw"IllegalArgument";var b=this.history;b={commands:b.slice(0,b.length-1)};localStorage.setItem(a,JSON.stringify(b))},load:function(a){if(!a)throw"IllegalArgument";if(a=localStorage.getItem(a)){a=JSON.parse(a);for(var b=0,c=a.commands.length;b< c;b++)try{this.acceptCommand(a.commands[b],true)}catch(d){}}else throw"ProcNotFound";},alias:function(a,b){this.alias(a,b)},clean:function(){var a=this.el;this.context.clearRect(0,0,a.width(),a.height());this.context.lineWidth=1;this.history=[]},clearscreen:function(){this.runCommand("clean");this.runCommand("home")},home:function(){this.x=this.halfWidth;this.y=this.halfHeight;this.heading=270;this.moveCursor(this.x,this.y);this.drawCursor()},pendown:function(){this.pendown=true;this.drawCursor()}, penup:function(){this.pendown=false;this.drawCursor()},penwidth:function(a){if(!(a=j(a)))throw"IllegalArgument";this.context.lineWidth=a},right:function(a){this.rotate(j(a))},left:function(a){this.rotate(j(a)*-1)},back:function(a){this.move(j(a)*-1)},forward:function(a){this.move(j(a))},moveto:function(a,b){if(!(a=j(a))||!(b=j(b)))throw"IllegalArgument";this.moveTo(a,b)},help:function(a){var b,c=["------------------------------------"],d;if(a&&(d=o[a])){c.push(a+" "+d[0]);c.push(d[1])}else{for(b in this.commands)n.indexOf(b)< 0&&c.push(b);c=["Type 'HELP <em>COMMAND</em>' for more info"].concat(c.sort())}c.push("------------------------------------");return c}}};TortugaConsole=function(a){$.extend(this,{history:[]},a||{});this.input=$(this.input);this.output=$(this.output)};TortugaConsole.prototype={init:function(){var a=this;a.input.focus().keydown(function(b){var c,d,e=a.tortuga,i=a.input,h=a.output;if(b.keyCode=="13"){b=a.processBang(i.val().toLowerCase(),e.history);try{d=e.acceptCommand(b)}catch(g){if(!(c=p[g]))throw g; }if(["clean","clearscreen","clear"].indexOf(b)!=-1)h.html("");else{h.prepend("<li>"+e.history.length+" "+b+"</li>");if(d){d=d.reverse();for(e=0;e<d.length;e++)h.prepend("<li>"+d[e]+"</li>")}}c&&h.prepend('<li class="error">'+c+"</li>");i.val("")}})},processBang:function(a,b){var c;if(c=a.match(/^!([0-9]*)$/)){c=j(c[1]);if(c=b[c-1])a=c}return a}};$(document).ready(function(){var a=new Tortuga({el:"#workspace",cursor:"#tortuga"}),b=new TortugaConsole({input:"#in",output:"#out",tortuga:a}),c=document.createElement("canvas"); c.width=c.height=200;c.style.width=c.style.height="200px";a.drawCursor(c.getContext("2d"),{height:200,width:200},{x:100,y:100},300,5,0.8);Math.round(Math.random()*25)==1?$("body").css("background-image","url("+c.toDataURL("image/png")+")"):$("#logo img").attr("src",c.toDataURL("image/png")).parent().fadeIn(2E3);b.init()})})();</script>
    </head>
    <body>
        <div id="content">
            <canvas id="tortuga" height="42" width="42"></canvas>
            <canvas id="workspace" height="300" width="300"></canvas>
            <div id="console">
                <span id="prompt">$</span>
                <input type="text" id="in" autocomplete="off"/>
                <ul id="out"><li>type "help" for commands</li></ul>
            </div>
            <div id="links">
                <a href="http://kembuco.github.com/tortuga/">latest</a><span>|</span><a href="http://github.com/kembuco/tortuga/issues">reqs/issues</a><span>|</span><a href="http://wiki.github.com/kembuco/tortuga/">help</a><span>|</span><a href="http://github.com/kembuco/tortuga">source</a><div></div>
            </div>
        </div>    
        <div id="logo" style="display:none;"><img/><span>TORTUGA</span></div>
    </body>
</html>