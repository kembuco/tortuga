<!doctype html>
<html>
    <head>
        <title>Tortuga Pen</title>
        <style type="text/css">body {background: url("http://img.wallpaperstock.net:81/green-hills-wallpapers_7371_1600x1200.jpg") no-repeat;margin: 20px;}#content{width:300px;background-color:rgba(223,223,223,0.6);-webkit-border-radius:5px;-moz-border-radius:5px;border-radius:5px;position:relative;margin:auto;padding:10px 10px 5px;}#tortuga{position:absolute;z-index:10;}#workspace{display:block;background-color:#FFF;}#console{margin-top:10px;width:290px;opacity:.8;padding:5px;}#console,#in{background-color:#000;color:#FFF;text-transform:uppercase;font-family:Lucida Console, Monaco, monospace;font-size:12px;}#console .error{color:red;}#in{width:273px;border:0;outline-width:0;}#out{height:205px;overflow:auto;list-style:none;margin:0;padding:0;}#links a,#links span{float:right;margin-left:5px;font-family:"Lucida Sans Unicode", "Lucida Grande", sans-serif;font-size:12px;color:#390;text-decoration:none;}#links div{clear:both;}</style>
        <script src="http://ajax.microsoft.com/ajax/jquery/jquery-1.4.2.min.js" type="text/javascript"></script>
        <script type="text/javascript">(function(){var i=parseInt,j=Math,k=j.PI,l=k*2,m=[],n={IllegalArgument:"Something is not right with the supplied arguments",UnknownCommand:"Command not recognized",ProcNotFound:"Couldn't find the specified program"};Tortuga=function(a){var b=this.alias;$.extend(this,{pendown:true,heading:270,history:[],x:0,y:0},a||{});a=this.el=$(this.el);var c=this.cursor=$(this.cursor),e=this.x=this.halfWidth=a.width()/2,d=this.y=this.halfHeight=a.height()/2;this.context=a[0].getContext("2d");this.cursorContext= c[0].getContext("2d");this.cursorOffset={x:c.width()/2,y:c.height()/2};this.moveCursor(e,d);this.drawCursor();b.call(this,"forward","fd");b.call(this,"back","bk");b.call(this,"right","rt");b.call(this,"left","lt");b.call(this,"penup","pu");b.call(this,"pendown","pd");b.call(this,"clearscreen","clear")};Tortuga.prototype={oob:function(a,b){return a<0||a>this.el.width()||b<0||b>this.el.height()},moveCursor:function(a,b){var c=this.cursor,e=this.cursorOffset,d=a-e.x+10;e=b-e.y+10;c[this.oob(a,b)?"hide": "show"]();c.css({top:e,left:d})},drawAnchoredCircle:function(a,b,c,e,d,f,g,h){g=(this.heading+(g||0))*k/180;h=15+(h||0);b=b+h*j.cos(g);c=c+h*j.sin(g);a.fillStyle=d;a.beginPath();a.arc(b,c,e,0,l,true);a.fill();f&&a.stroke()},drawCursor:function(){var a=this.cursor,b=this.cursorContext,c=this.cursorOffset,e=this.drawAnchoredCircle,d=c.x,f=c.y;b.clearRect(0,0,a.width(),a.height());b.globalAlpha=0.6;b.strokeStyle="#996633";a=b.createRadialGradient(d,f,1,d,f,10);a.addColorStop(0,"#66CC33");a.addColorStop(1, "#339900");b.fillStyle=a;b.beginPath();b.arc(c.x,c.y,10,0,l,true);b.fill();b.stroke();e.call(this,b,d,f,5,"#66CC33",true);e.call(this,b,d,f,1,"#000000",false,-6,1);e.call(this,b,d,f,1,"#000000",false,6,1);e.call(this,b,d,f,2,"#66CC33",true,-45,-3);e.call(this,b,d,f,2,"#66CC33",true,45,-3);e.call(this,b,d,f,2,"#66CC33",true,-135,-3);e.call(this,b,d,f,2,"#66CC33",true,135,-3)},acceptCommand:function(a,b){if(a){var c=this.parseDirective(a);b||this.history.push(a);return this.runCommand(c.command,c.args)}}, runCommand:function(a,b){if(a=this.commands[a])return a.apply(this,b);else throw"UnknownCommand";},parseDirective:function(a){a=a.replace(/[\[|\]]/g," ").split(" ");return{command:a.reverse().pop().replace("?","p"),args:$.grep(a.reverse(),function(b){return b!==""})}},rotate:function(a){if(!a&&a!==0)throw"IllegalArgument";a=this.heading+a;this.heading=a>360?a%360:a<0?360+a%360:a;this.drawCursor()},move:function(a){if(!a&&a!==0)throw"IllegalArgument";var b=Math,c=b.PI,e=this.heading,d=this.context, f=this.x+a*b.cos(e*c/180);a=this.y+a*b.sin(e*c/180);if(this.pendown){d.lineJoin="miter";d.beginPath();d.moveTo(this.x,this.y);d.lineTo(f,a);d.stroke()}this.x=f;this.y=a;this.moveCursor(f,a)},alias:function(a,b){if(!this.commands[a])throw"IllegalArgument";this.commands[b]=this.commands[a];m.push(b)},commands:{saveas:function(a){if(!a)throw"IllegalArgument";var b=this.history;b={commands:b.slice(0,b.length-1)};localStorage.setItem(a,JSON.stringify(b))},load:function(a){if(!a)throw"IllegalArgument"; if(a=localStorage.getItem(a)){a=JSON.parse(a);for(var b=0,c=a.commands.length;b<c;b++)try{this.acceptCommand(a.commands[b],true)}catch(e){}}else throw"ProcNotFound";},alias:function(a,b){this.alias(a,b)},clean:function(){var a=this.el;this.context.clearRect(0,0,a.width(),a.height());this.history=[]},clearscreen:function(){this.runCommand("clean");this.runCommand("home")},home:function(){this.x=this.halfWidth;this.y=this.halfHeight;this.heading=270;this.moveCursor(this.x,this.y);this.drawCursor()}, pendown:function(){this.pendown=true},penup:function(){this.pendown=false},right:function(a){this.rotate(i(a))},left:function(a){this.rotate(i(a)*-1)},back:function(a){this.move(i(a)*-1)},forward:function(a){this.move(i(a))},help:function(){var a,b=[];for(a in this.commands)m.indexOf(a)<0&&b.push(a);return["commands:"].concat(b.sort())}}};TortugaConsole=function(a){$.extend(this,{history:[]},a||{});this.input=$(this.input);this.output=$(this.output)};TortugaConsole.prototype={init:function(){var a= this;a.input.focus().keydown(function(b){var c,e,d=a.tortuga,f=a.input,g=a.output;if(b.keyCode=="13"){b=a.processBang(f.val().toLowerCase(),d.history);try{e=d.acceptCommand(b)}catch(h){c=n[h]}if(["clean","clearscreen","clear"].indexOf(b)!=-1)g.html("");else{g.prepend("<li>"+d.history.length+" "+b+"</li>");if(e){e=e.reverse();for(d=0;d<e.length;d++)g.prepend("<li>"+e[d]+"</li>")}}c&&g.prepend('<li class="error">'+c+"</li>");f.val("")}})},processBang:function(a,b){var c;if(c=a.match(/^!([0-9]*)$/)){c= i(c[1]);if(c=b[c-1])a=c}return a}};$(document).ready(function(){var a=new Tortuga({el:"#workspace",cursor:"#tortuga"});(new TortugaConsole({input:"#in",output:"#out",tortuga:a})).init()})})();</script>
    </head>
    <body>
        <div id="content">
            <canvas id="tortuga" height="42" width="42"></canvas>
            <canvas id="workspace" height="300" width="300"></canvas>
            <div id="console">
                <span id="prompt">$</span>
                <input type="text" id="in" autocomplete="off"/>
                <ul id="out"></ul>
            </div>
            <div id="links">
                <a href="http://wiki.github.com/kembuco/tortuga/">help</a>
                <span>|</span>
                <a href="http://github.com/kembuco/tortuga">source</a>
                <div></div>
            </div>
        </div>
    </body>
</html>